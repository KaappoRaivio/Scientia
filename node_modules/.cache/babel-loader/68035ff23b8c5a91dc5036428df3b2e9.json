{"ast":null,"code":"import { clone } from '../../utils/object';\nimport { factory } from '../../utils/factory';\nimport { format } from '../../utils/string';\nvar name = 'eigs';\nvar dependencies = ['config', 'typed', 'matrix', 'addScalar', 'equal', 'subtract', 'abs', 'atan', 'cos', 'sin', 'multiplyScalar', 'inv', 'bignumber', 'multiply', 'add'];\nexport var createEigs = /* #__PURE__ */factory(name, dependencies, function (_ref) {\n  var config = _ref.config,\n      typed = _ref.typed,\n      matrix = _ref.matrix,\n      addScalar = _ref.addScalar,\n      subtract = _ref.subtract,\n      equal = _ref.equal,\n      abs = _ref.abs,\n      atan = _ref.atan,\n      cos = _ref.cos,\n      sin = _ref.sin,\n      multiplyScalar = _ref.multiplyScalar,\n      inv = _ref.inv,\n      bignumber = _ref.bignumber,\n      multiply = _ref.multiply,\n      add = _ref.add;\n  /**\n   * Compute eigenvalue and eigenvector of a real symmetric matrix.\n   * Only applicable to two dimensional symmetric matrices. Uses Jacobi\n   * Algorithm. Matrix containing mixed type ('number', 'bignumber', 'fraction')\n   * of elements are not supported. Input matrix or 2D array should contain all elements\n   * of either 'number', 'bignumber' or 'fraction' type. For 'number' and 'fraction', the\n   * eigenvalues are of 'number' type. For 'bignumber' the eigenvalues are of ''bignumber' type.\n   * Eigenvectors are always of 'number' type.\n   *\n   * Syntax:\n   *\n   *     math.eigs(x)\n   *\n   * Examples:\n   *\n   *     const H = [[5, 2.3], [2.3, 1]]\n   *     const ans = math.eigs(H) // returns {values: [E1,E2...sorted], vectors: [v1,v2.... corresponding vectors]}\n   *     const E = ans.values\n   *     const U = ans.vectors\n   *     const UTxHxU = math.multiply(math.transpose(U), H, U) // rotates H to the eigen-representation\n   *     E[0] == UTxHxU[0][0]  // returns true\n   * See also:\n   *\n   *     inv\n   *\n   * @param {Array | Matrix} x  Matrix to be diagonalized\n   * @return {{values: Array, vectors: Array} | {values: Matrix, vectors: Matrix}} Object containing eigenvalues (Array or Matrix) and eigenvectors (2D Array/Matrix).\n   */\n\n  var eigs = typed('eigs', {\n    Array: function Array(x) {\n      // check array size\n      var mat = matrix(x);\n      var size = mat.size();\n\n      if (size.length !== 2 || size[0] !== size[1]) {\n        throw new RangeError('Matrix must be square ' + '(size: ' + format(size) + ')');\n      } // use dense 2D matrix implementation\n\n\n      var ans = checkAndSubmit(mat, size[0]);\n      return {\n        values: ans[0],\n        vectors: ans[1]\n      };\n    },\n    Matrix: function Matrix(x) {\n      // use dense 2D array implementation\n      // dense matrix\n      var size = x.size();\n\n      if (size.length !== 2 || size[0] !== size[1]) {\n        throw new RangeError('Matrix must be square ' + '(size: ' + format(size) + ')');\n      }\n\n      var ans = checkAndSubmit(x, size[0]);\n      return {\n        values: matrix(ans[0]),\n        vectors: matrix(ans[1])\n      };\n    }\n  }); // Is the matrix\n  // symmetric ?\n\n  function isSymmetric(x, n) {\n    for (var i = 0; i < n; i++) {\n      for (var j = i; j < n; j++) {\n        // not symmtric\n        if (!equal(x[i][j], x[j][i])) {\n          throw new TypeError('Input matrix is not symmetric');\n        }\n      }\n    }\n  } // check input for possible problems\n  // and perform diagonalization efficiently for\n  // specific type of number\n\n\n  function checkAndSubmit(x, n) {\n    var type = x.datatype(); // type check\n\n    if (type === undefined) {\n      type = x.getDataType();\n    }\n\n    if (type !== 'number' && type !== 'BigNumber' && type !== 'Fraction') {\n      if (type === 'mixed') {\n        throw new TypeError('Mixed matrix element type is not supported');\n      } else {\n        throw new TypeError('Matrix element type not supported (' + type + ')');\n      }\n    } else {\n      isSymmetric(x.toArray(), n);\n    } // perform efficient calculation for 'numbers'\n\n\n    if (type === 'number') {\n      return diag(x.toArray());\n    } else if (type === 'Fraction') {\n      var xArr = x.toArray(); // convert fraction to numbers\n\n      for (var i = 0; i < n; i++) {\n        for (var j = i; j < n; j++) {\n          xArr[i][j] = xArr[i][j].valueOf();\n          xArr[j][i] = xArr[i][j];\n        }\n      }\n\n      return diag(x.toArray());\n    } else if (type === 'BigNumber') {\n      return diagBig(x.toArray());\n    }\n  } // diagonalization implementation for number (efficient)\n\n\n  function diag(x) {\n    var N = x.length;\n    var e0 = Math.abs(config.epsilon / N);\n    var psi;\n    var Sij = new Array(N); // Sij is Identity Matrix\n\n    for (var i = 0; i < N; i++) {\n      Sij[i] = createArray(N, 0);\n      Sij[i][i] = 1.0;\n    } // initial error\n\n\n    var Vab = getAij(x);\n\n    while (Math.abs(Vab[1]) >= Math.abs(e0)) {\n      var _i = Vab[0][0];\n      var j = Vab[0][1];\n      psi = getTheta(x[_i][_i], x[j][j], x[_i][j]);\n      x = x1(x, psi, _i, j);\n      Sij = Sij1(Sij, psi, _i, j);\n      Vab = getAij(x);\n    }\n\n    var Ei = createArray(N, 0); // eigenvalues\n\n    for (var _i2 = 0; _i2 < N; _i2++) {\n      Ei[_i2] = x[_i2][_i2];\n    }\n\n    return sorting(clone(Ei), clone(Sij));\n  } // diagonalization implementation for bigNumber\n\n\n  function diagBig(x) {\n    var N = x.length;\n    var e0 = abs(config.epsilon / N);\n    var psi;\n    var Sij = new Array(N); // Sij is Identity Matrix\n\n    for (var i = 0; i < N; i++) {\n      Sij[i] = createArray(N, 0);\n      Sij[i][i] = 1.0;\n    } // initial error\n\n\n    var Vab = getAijBig(x);\n\n    while (abs(Vab[1]) >= abs(e0)) {\n      var _i3 = Vab[0][0];\n      var j = Vab[0][1];\n      psi = getThetaBig(x[_i3][_i3], x[j][j], x[_i3][j]);\n      x = x1Big(x, psi, _i3, j);\n      Sij = Sij1Big(Sij, psi, _i3, j);\n      Vab = getAijBig(x);\n    }\n\n    var Ei = createArray(N, 0); // eigenvalues\n\n    for (var _i4 = 0; _i4 < N; _i4++) {\n      Ei[_i4] = x[_i4][_i4];\n    } // return [clone(Ei), clone(Sij)]\n\n\n    return sorting(clone(Ei), clone(Sij));\n  } // get angle\n\n\n  function getTheta(aii, ajj, aij) {\n    var denom = ajj - aii;\n\n    if (Math.abs(denom) <= config.epsilon) {\n      return Math.PI / 4;\n    } else {\n      return 0.5 * Math.atan(2 * aij / (ajj - aii));\n    }\n  } // get angle\n\n\n  function getThetaBig(aii, ajj, aij) {\n    var denom = subtract(ajj, aii);\n\n    if (abs(denom) <= config.epsilon) {\n      return bignumber(-1).acos().div(4);\n    } else {\n      return multiplyScalar(0.5, atan(multiply(2, aij, inv(denom))));\n    }\n  } // update eigvec\n\n\n  function Sij1(Sij, theta, i, j) {\n    var N = Sij.length;\n    var c = Math.cos(theta);\n    var s = Math.sin(theta);\n    var Ski = createArray(N, 0);\n    var Skj = createArray(N, 0);\n\n    for (var k = 0; k < N; k++) {\n      Ski[k] = c * Sij[k][i] - s * Sij[k][j];\n      Skj[k] = s * Sij[k][i] + c * Sij[k][j];\n    }\n\n    for (var _k = 0; _k < N; _k++) {\n      Sij[_k][i] = Ski[_k];\n      Sij[_k][j] = Skj[_k];\n    }\n\n    return Sij;\n  } // update eigvec for overlap\n\n\n  function Sij1Big(Sij, theta, i, j) {\n    var N = Sij.length;\n    var c = cos(theta);\n    var s = sin(theta);\n    var Ski = createArray(N, bignumber(0));\n    var Skj = createArray(N, bignumber(0));\n\n    for (var k = 0; k < N; k++) {\n      Ski[k] = subtract(multiplyScalar(c, Sij[k][i]), multiplyScalar(s, Sij[k][j]));\n      Skj[k] = addScalar(multiplyScalar(s, Sij[k][i]), multiplyScalar(c, Sij[k][j]));\n    }\n\n    for (var _k2 = 0; _k2 < N; _k2++) {\n      Sij[_k2][i] = Ski[_k2];\n      Sij[_k2][j] = Skj[_k2];\n    }\n\n    return Sij;\n  } // update matrix\n\n\n  function x1Big(Hij, theta, i, j) {\n    var N = Hij.length;\n    var c = bignumber(cos(theta));\n    var s = bignumber(sin(theta));\n    var c2 = multiplyScalar(c, c);\n    var s2 = multiplyScalar(s, s);\n    var Aki = createArray(N, bignumber(0));\n    var Akj = createArray(N, bignumber(0)); // 2cs Hij\n\n    var csHij = multiply(bignumber(2), c, s, Hij[i][j]); //  Aii\n\n    var Aii = addScalar(subtract(multiplyScalar(c2, Hij[i][i]), csHij), multiplyScalar(s2, Hij[j][j]));\n    var Ajj = add(multiplyScalar(s2, Hij[i][i]), csHij, multiplyScalar(c2, Hij[j][j])); // 0  to i\n\n    for (var k = 0; k < N; k++) {\n      Aki[k] = subtract(multiplyScalar(c, Hij[i][k]), multiplyScalar(s, Hij[j][k]));\n      Akj[k] = addScalar(multiplyScalar(s, Hij[i][k]), multiplyScalar(c, Hij[j][k]));\n    } // Modify Hij\n\n\n    Hij[i][i] = Aii;\n    Hij[j][j] = Ajj;\n    Hij[i][j] = bignumber(0);\n    Hij[j][i] = bignumber(0); // 0  to i\n\n    for (var _k3 = 0; _k3 < N; _k3++) {\n      if (_k3 !== i && _k3 !== j) {\n        Hij[i][_k3] = Aki[_k3];\n        Hij[_k3][i] = Aki[_k3];\n        Hij[j][_k3] = Akj[_k3];\n        Hij[_k3][j] = Akj[_k3];\n      }\n    }\n\n    return Hij;\n  } // update matrix\n\n\n  function x1(Hij, theta, i, j) {\n    var N = Hij.length;\n    var c = Math.cos(theta);\n    var s = Math.sin(theta);\n    var c2 = c * c;\n    var s2 = s * s;\n    var Aki = createArray(N, 0);\n    var Akj = createArray(N, 0); //  Aii\n\n    var Aii = c2 * Hij[i][i] - 2 * c * s * Hij[i][j] + s2 * Hij[j][j];\n    var Ajj = s2 * Hij[i][i] + 2 * c * s * Hij[i][j] + c2 * Hij[j][j]; // 0  to i\n\n    for (var k = 0; k < N; k++) {\n      Aki[k] = c * Hij[i][k] - s * Hij[j][k];\n      Akj[k] = s * Hij[i][k] + c * Hij[j][k];\n    } // Modify Hij\n\n\n    Hij[i][i] = Aii;\n    Hij[j][j] = Ajj;\n    Hij[i][j] = 0;\n    Hij[j][i] = 0; // 0  to i\n\n    for (var _k4 = 0; _k4 < N; _k4++) {\n      if (_k4 !== i && _k4 !== j) {\n        Hij[i][_k4] = Aki[_k4];\n        Hij[_k4][i] = Aki[_k4];\n        Hij[j][_k4] = Akj[_k4];\n        Hij[_k4][j] = Akj[_k4];\n      }\n    }\n\n    return Hij;\n  } // get max off-diagonal value from Upper Diagonal\n\n\n  function getAij(Mij) {\n    var N = Mij.length;\n    var maxMij = 0;\n    var maxIJ = [0, 1];\n\n    for (var i = 0; i < N; i++) {\n      for (var j = i + 1; j < N; j++) {\n        if (Math.abs(maxMij) < Math.abs(Mij[i][j])) {\n          maxMij = Math.abs(Mij[i][j]);\n          maxIJ = [i, j];\n        }\n      }\n    }\n\n    return [maxIJ, maxMij];\n  } // get max off-diagonal value from Upper Diagonal\n\n\n  function getAijBig(Mij) {\n    var N = Mij.length;\n    var maxMij = 0;\n    var maxIJ = [0, 1];\n\n    for (var i = 0; i < N; i++) {\n      for (var j = i + 1; j < N; j++) {\n        if (abs(maxMij) < abs(Mij[i][j])) {\n          maxMij = abs(Mij[i][j]);\n          maxIJ = [i, j];\n        }\n      }\n    }\n\n    return [maxIJ, maxMij];\n  } // sort results\n\n\n  function sorting(E, S) {\n    var N = E.length;\n    var Ef = Array(N);\n    var Sf = Array(N);\n\n    for (var k = 0; k < N; k++) {\n      Sf[k] = Array(N);\n    }\n\n    for (var i = 0; i < N; i++) {\n      var minID = 0;\n      var minE = E[0];\n\n      for (var j = 0; j < E.length; j++) {\n        if (E[j] < minE) {\n          minID = j;\n          minE = E[minID];\n        }\n      }\n\n      Ef[i] = E.splice(minID, 1)[0];\n\n      for (var _k5 = 0; _k5 < N; _k5++) {\n        Sf[_k5][i] = S[_k5][minID];\n\n        S[_k5].splice(minID, 1);\n      }\n    }\n\n    return [clone(Ef), clone(Sf)];\n  }\n  /**\n   * Create an array of a certain size and fill all items with an initial value\n   * @param {number} size\n   * @param {number} value\n   * @return {number[]}\n   */\n\n\n  function createArray(size, value) {\n    // TODO: as soon as all browsers support Array.fill, use that instead (IE doesn't support it)\n    var array = new Array(size);\n\n    for (var i = 0; i < size; i++) {\n      array[i] = value;\n    }\n\n    return array;\n  }\n\n  return eigs;\n});","map":{"version":3,"sources":["/home/kaappo/git/kments/node_modules/mathjs/es/function/matrix/eigs.js"],"names":["clone","factory","format","name","dependencies","createEigs","_ref","config","typed","matrix","addScalar","subtract","equal","abs","atan","cos","sin","multiplyScalar","inv","bignumber","multiply","add","eigs","Array","x","mat","size","length","RangeError","ans","checkAndSubmit","values","vectors","Matrix","isSymmetric","n","i","j","TypeError","type","datatype","undefined","getDataType","toArray","diag","xArr","valueOf","diagBig","N","e0","Math","epsilon","psi","Sij","createArray","Vab","getAij","_i","getTheta","x1","Sij1","Ei","_i2","sorting","getAijBig","_i3","getThetaBig","x1Big","Sij1Big","_i4","aii","ajj","aij","denom","PI","acos","div","theta","c","s","Ski","Skj","k","_k","_k2","Hij","c2","s2","Aki","Akj","csHij","Aii","Ajj","_k3","_k4","Mij","maxMij","maxIJ","E","S","Ef","Sf","minID","minE","splice","_k5","value","array"],"mappings":"AAAA,SAASA,KAAT,QAAsB,oBAAtB;AACA,SAASC,OAAT,QAAwB,qBAAxB;AACA,SAASC,MAAT,QAAuB,oBAAvB;AACA,IAAIC,IAAI,GAAG,MAAX;AACA,IAAIC,YAAY,GAAG,CAAC,QAAD,EAAW,OAAX,EAAoB,QAApB,EAA8B,WAA9B,EAA2C,OAA3C,EAAoD,UAApD,EAAgE,KAAhE,EAAuE,MAAvE,EAA+E,KAA/E,EAAsF,KAAtF,EAA6F,gBAA7F,EAA+G,KAA/G,EAAsH,WAAtH,EAAmI,UAAnI,EAA+I,KAA/I,CAAnB;AACA,OAAO,IAAIC,UAAU,GAAG,eAAeJ,OAAO,CAACE,IAAD,EAAOC,YAAP,EAAqB,UAAUE,IAAV,EAAgB;AACjF,MAAIC,MAAM,GAAGD,IAAI,CAACC,MAAlB;AAAA,MACIC,KAAK,GAAGF,IAAI,CAACE,KADjB;AAAA,MAEIC,MAAM,GAAGH,IAAI,CAACG,MAFlB;AAAA,MAGIC,SAAS,GAAGJ,IAAI,CAACI,SAHrB;AAAA,MAIIC,QAAQ,GAAGL,IAAI,CAACK,QAJpB;AAAA,MAKIC,KAAK,GAAGN,IAAI,CAACM,KALjB;AAAA,MAMIC,GAAG,GAAGP,IAAI,CAACO,GANf;AAAA,MAOIC,IAAI,GAAGR,IAAI,CAACQ,IAPhB;AAAA,MAQIC,GAAG,GAAGT,IAAI,CAACS,GARf;AAAA,MASIC,GAAG,GAAGV,IAAI,CAACU,GATf;AAAA,MAUIC,cAAc,GAAGX,IAAI,CAACW,cAV1B;AAAA,MAWIC,GAAG,GAAGZ,IAAI,CAACY,GAXf;AAAA,MAYIC,SAAS,GAAGb,IAAI,CAACa,SAZrB;AAAA,MAaIC,QAAQ,GAAGd,IAAI,CAACc,QAbpB;AAAA,MAcIC,GAAG,GAAGf,IAAI,CAACe,GAdf;AAgBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA,MAAIC,IAAI,GAAGd,KAAK,CAAC,MAAD,EAAS;AACvBe,IAAAA,KAAK,EAAE,SAASA,KAAT,CAAeC,CAAf,EAAkB;AACvB;AACA,UAAIC,GAAG,GAAGhB,MAAM,CAACe,CAAD,CAAhB;AACA,UAAIE,IAAI,GAAGD,GAAG,CAACC,IAAJ,EAAX;;AAEA,UAAIA,IAAI,CAACC,MAAL,KAAgB,CAAhB,IAAqBD,IAAI,CAAC,CAAD,CAAJ,KAAYA,IAAI,CAAC,CAAD,CAAzC,EAA8C;AAC5C,cAAM,IAAIE,UAAJ,CAAe,2BAA2B,SAA3B,GAAuC1B,MAAM,CAACwB,IAAD,CAA7C,GAAsD,GAArE,CAAN;AACD,OAPsB,CAOrB;;;AAGF,UAAIG,GAAG,GAAGC,cAAc,CAACL,GAAD,EAAMC,IAAI,CAAC,CAAD,CAAV,CAAxB;AACA,aAAO;AACLK,QAAAA,MAAM,EAAEF,GAAG,CAAC,CAAD,CADN;AAELG,QAAAA,OAAO,EAAEH,GAAG,CAAC,CAAD;AAFP,OAAP;AAID,KAhBsB;AAiBvBI,IAAAA,MAAM,EAAE,SAASA,MAAT,CAAgBT,CAAhB,EAAmB;AACzB;AACA;AACA,UAAIE,IAAI,GAAGF,CAAC,CAACE,IAAF,EAAX;;AAEA,UAAIA,IAAI,CAACC,MAAL,KAAgB,CAAhB,IAAqBD,IAAI,CAAC,CAAD,CAAJ,KAAYA,IAAI,CAAC,CAAD,CAAzC,EAA8C;AAC5C,cAAM,IAAIE,UAAJ,CAAe,2BAA2B,SAA3B,GAAuC1B,MAAM,CAACwB,IAAD,CAA7C,GAAsD,GAArE,CAAN;AACD;;AAED,UAAIG,GAAG,GAAGC,cAAc,CAACN,CAAD,EAAIE,IAAI,CAAC,CAAD,CAAR,CAAxB;AACA,aAAO;AACLK,QAAAA,MAAM,EAAEtB,MAAM,CAACoB,GAAG,CAAC,CAAD,CAAJ,CADT;AAELG,QAAAA,OAAO,EAAEvB,MAAM,CAACoB,GAAG,CAAC,CAAD,CAAJ;AAFV,OAAP;AAID;AA/BsB,GAAT,CAAhB,CA7CiF,CA6E7E;AACJ;;AAEA,WAASK,WAAT,CAAqBV,CAArB,EAAwBW,CAAxB,EAA2B;AACzB,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,CAApB,EAAuBC,CAAC,EAAxB,EAA4B;AAC1B,WAAK,IAAIC,CAAC,GAAGD,CAAb,EAAgBC,CAAC,GAAGF,CAApB,EAAuBE,CAAC,EAAxB,EAA4B;AAC1B;AACA,YAAI,CAACzB,KAAK,CAACY,CAAC,CAACY,CAAD,CAAD,CAAKC,CAAL,CAAD,EAAUb,CAAC,CAACa,CAAD,CAAD,CAAKD,CAAL,CAAV,CAAV,EAA8B;AAC5B,gBAAM,IAAIE,SAAJ,CAAc,+BAAd,CAAN;AACD;AACF;AACF;AACF,GAzFgF,CAyF/E;AACF;AACA;;;AAGA,WAASR,cAAT,CAAwBN,CAAxB,EAA2BW,CAA3B,EAA8B;AAC5B,QAAII,IAAI,GAAGf,CAAC,CAACgB,QAAF,EAAX,CAD4B,CACH;;AAEzB,QAAID,IAAI,KAAKE,SAAb,EAAwB;AACtBF,MAAAA,IAAI,GAAGf,CAAC,CAACkB,WAAF,EAAP;AACD;;AAED,QAAIH,IAAI,KAAK,QAAT,IAAqBA,IAAI,KAAK,WAA9B,IAA6CA,IAAI,KAAK,UAA1D,EAAsE;AACpE,UAAIA,IAAI,KAAK,OAAb,EAAsB;AACpB,cAAM,IAAID,SAAJ,CAAc,4CAAd,CAAN;AACD,OAFD,MAEO;AACL,cAAM,IAAIA,SAAJ,CAAc,wCAAwCC,IAAxC,GAA+C,GAA7D,CAAN;AACD;AACF,KAND,MAMO;AACLL,MAAAA,WAAW,CAACV,CAAC,CAACmB,OAAF,EAAD,EAAcR,CAAd,CAAX;AACD,KAf2B,CAe1B;;;AAGF,QAAII,IAAI,KAAK,QAAb,EAAuB;AACrB,aAAOK,IAAI,CAACpB,CAAC,CAACmB,OAAF,EAAD,CAAX;AACD,KAFD,MAEO,IAAIJ,IAAI,KAAK,UAAb,EAAyB;AAC9B,UAAIM,IAAI,GAAGrB,CAAC,CAACmB,OAAF,EAAX,CAD8B,CACN;;AAExB,WAAK,IAAIP,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,CAApB,EAAuBC,CAAC,EAAxB,EAA4B;AAC1B,aAAK,IAAIC,CAAC,GAAGD,CAAb,EAAgBC,CAAC,GAAGF,CAApB,EAAuBE,CAAC,EAAxB,EAA4B;AAC1BQ,UAAAA,IAAI,CAACT,CAAD,CAAJ,CAAQC,CAAR,IAAaQ,IAAI,CAACT,CAAD,CAAJ,CAAQC,CAAR,EAAWS,OAAX,EAAb;AACAD,UAAAA,IAAI,CAACR,CAAD,CAAJ,CAAQD,CAAR,IAAaS,IAAI,CAACT,CAAD,CAAJ,CAAQC,CAAR,CAAb;AACD;AACF;;AAED,aAAOO,IAAI,CAACpB,CAAC,CAACmB,OAAF,EAAD,CAAX;AACD,KAXM,MAWA,IAAIJ,IAAI,KAAK,WAAb,EAA0B;AAC/B,aAAOQ,OAAO,CAACvB,CAAC,CAACmB,OAAF,EAAD,CAAd;AACD;AACF,GAhIgF,CAgI/E;;;AAGF,WAASC,IAAT,CAAcpB,CAAd,EAAiB;AACf,QAAIwB,CAAC,GAAGxB,CAAC,CAACG,MAAV;AACA,QAAIsB,EAAE,GAAGC,IAAI,CAACrC,GAAL,CAASN,MAAM,CAAC4C,OAAP,GAAiBH,CAA1B,CAAT;AACA,QAAII,GAAJ;AACA,QAAIC,GAAG,GAAG,IAAI9B,KAAJ,CAAUyB,CAAV,CAAV,CAJe,CAIS;;AAExB,SAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGY,CAApB,EAAuBZ,CAAC,EAAxB,EAA4B;AAC1BiB,MAAAA,GAAG,CAACjB,CAAD,CAAH,GAASkB,WAAW,CAACN,CAAD,EAAI,CAAJ,CAApB;AACAK,MAAAA,GAAG,CAACjB,CAAD,CAAH,CAAOA,CAAP,IAAY,GAAZ;AACD,KATc,CASb;;;AAGF,QAAImB,GAAG,GAAGC,MAAM,CAAChC,CAAD,CAAhB;;AAEA,WAAO0B,IAAI,CAACrC,GAAL,CAAS0C,GAAG,CAAC,CAAD,CAAZ,KAAoBL,IAAI,CAACrC,GAAL,CAASoC,EAAT,CAA3B,EAAyC;AACvC,UAAIQ,EAAE,GAAGF,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAT;AACA,UAAIlB,CAAC,GAAGkB,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAR;AACAH,MAAAA,GAAG,GAAGM,QAAQ,CAAClC,CAAC,CAACiC,EAAD,CAAD,CAAMA,EAAN,CAAD,EAAYjC,CAAC,CAACa,CAAD,CAAD,CAAKA,CAAL,CAAZ,EAAqBb,CAAC,CAACiC,EAAD,CAAD,CAAMpB,CAAN,CAArB,CAAd;AACAb,MAAAA,CAAC,GAAGmC,EAAE,CAACnC,CAAD,EAAI4B,GAAJ,EAASK,EAAT,EAAapB,CAAb,CAAN;AACAgB,MAAAA,GAAG,GAAGO,IAAI,CAACP,GAAD,EAAMD,GAAN,EAAWK,EAAX,EAAepB,CAAf,CAAV;AACAkB,MAAAA,GAAG,GAAGC,MAAM,CAAChC,CAAD,CAAZ;AACD;;AAED,QAAIqC,EAAE,GAAGP,WAAW,CAACN,CAAD,EAAI,CAAJ,CAApB,CAvBe,CAuBa;;AAE5B,SAAK,IAAIc,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGd,CAAxB,EAA2Bc,GAAG,EAA9B,EAAkC;AAChCD,MAAAA,EAAE,CAACC,GAAD,CAAF,GAAUtC,CAAC,CAACsC,GAAD,CAAD,CAAOA,GAAP,CAAV;AACD;;AAED,WAAOC,OAAO,CAAC/D,KAAK,CAAC6D,EAAD,CAAN,EAAY7D,KAAK,CAACqD,GAAD,CAAjB,CAAd;AACD,GAjKgF,CAiK/E;;;AAGF,WAASN,OAAT,CAAiBvB,CAAjB,EAAoB;AAClB,QAAIwB,CAAC,GAAGxB,CAAC,CAACG,MAAV;AACA,QAAIsB,EAAE,GAAGpC,GAAG,CAACN,MAAM,CAAC4C,OAAP,GAAiBH,CAAlB,CAAZ;AACA,QAAII,GAAJ;AACA,QAAIC,GAAG,GAAG,IAAI9B,KAAJ,CAAUyB,CAAV,CAAV,CAJkB,CAIM;;AAExB,SAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGY,CAApB,EAAuBZ,CAAC,EAAxB,EAA4B;AAC1BiB,MAAAA,GAAG,CAACjB,CAAD,CAAH,GAASkB,WAAW,CAACN,CAAD,EAAI,CAAJ,CAApB;AACAK,MAAAA,GAAG,CAACjB,CAAD,CAAH,CAAOA,CAAP,IAAY,GAAZ;AACD,KATiB,CAShB;;;AAGF,QAAImB,GAAG,GAAGS,SAAS,CAACxC,CAAD,CAAnB;;AAEA,WAAOX,GAAG,CAAC0C,GAAG,CAAC,CAAD,CAAJ,CAAH,IAAe1C,GAAG,CAACoC,EAAD,CAAzB,EAA+B;AAC7B,UAAIgB,GAAG,GAAGV,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAV;AACA,UAAIlB,CAAC,GAAGkB,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAR;AACAH,MAAAA,GAAG,GAAGc,WAAW,CAAC1C,CAAC,CAACyC,GAAD,CAAD,CAAOA,GAAP,CAAD,EAAczC,CAAC,CAACa,CAAD,CAAD,CAAKA,CAAL,CAAd,EAAuBb,CAAC,CAACyC,GAAD,CAAD,CAAO5B,CAAP,CAAvB,CAAjB;AACAb,MAAAA,CAAC,GAAG2C,KAAK,CAAC3C,CAAD,EAAI4B,GAAJ,EAASa,GAAT,EAAc5B,CAAd,CAAT;AACAgB,MAAAA,GAAG,GAAGe,OAAO,CAACf,GAAD,EAAMD,GAAN,EAAWa,GAAX,EAAgB5B,CAAhB,CAAb;AACAkB,MAAAA,GAAG,GAAGS,SAAS,CAACxC,CAAD,CAAf;AACD;;AAED,QAAIqC,EAAE,GAAGP,WAAW,CAACN,CAAD,EAAI,CAAJ,CAApB,CAvBkB,CAuBU;;AAE5B,SAAK,IAAIqB,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGrB,CAAxB,EAA2BqB,GAAG,EAA9B,EAAkC;AAChCR,MAAAA,EAAE,CAACQ,GAAD,CAAF,GAAU7C,CAAC,CAAC6C,GAAD,CAAD,CAAOA,GAAP,CAAV;AACD,KA3BiB,CA2BhB;;;AAGF,WAAON,OAAO,CAAC/D,KAAK,CAAC6D,EAAD,CAAN,EAAY7D,KAAK,CAACqD,GAAD,CAAjB,CAAd;AACD,GAnMgF,CAmM/E;;;AAGF,WAASK,QAAT,CAAkBY,GAAlB,EAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC/B,QAAIC,KAAK,GAAGF,GAAG,GAAGD,GAAlB;;AAEA,QAAIpB,IAAI,CAACrC,GAAL,CAAS4D,KAAT,KAAmBlE,MAAM,CAAC4C,OAA9B,EAAuC;AACrC,aAAOD,IAAI,CAACwB,EAAL,GAAU,CAAjB;AACD,KAFD,MAEO;AACL,aAAO,MAAMxB,IAAI,CAACpC,IAAL,CAAU,IAAI0D,GAAJ,IAAWD,GAAG,GAAGD,GAAjB,CAAV,CAAb;AACD;AACF,GA9MgF,CA8M/E;;;AAGF,WAASJ,WAAT,CAAqBI,GAArB,EAA0BC,GAA1B,EAA+BC,GAA/B,EAAoC;AAClC,QAAIC,KAAK,GAAG9D,QAAQ,CAAC4D,GAAD,EAAMD,GAAN,CAApB;;AAEA,QAAIzD,GAAG,CAAC4D,KAAD,CAAH,IAAclE,MAAM,CAAC4C,OAAzB,EAAkC;AAChC,aAAOhC,SAAS,CAAC,CAAC,CAAF,CAAT,CAAcwD,IAAd,GAAqBC,GAArB,CAAyB,CAAzB,CAAP;AACD,KAFD,MAEO;AACL,aAAO3D,cAAc,CAAC,GAAD,EAAMH,IAAI,CAACM,QAAQ,CAAC,CAAD,EAAIoD,GAAJ,EAAStD,GAAG,CAACuD,KAAD,CAAZ,CAAT,CAAV,CAArB;AACD;AACF,GAzNgF,CAyN/E;;;AAGF,WAASb,IAAT,CAAcP,GAAd,EAAmBwB,KAAnB,EAA0BzC,CAA1B,EAA6BC,CAA7B,EAAgC;AAC9B,QAAIW,CAAC,GAAGK,GAAG,CAAC1B,MAAZ;AACA,QAAImD,CAAC,GAAG5B,IAAI,CAACnC,GAAL,CAAS8D,KAAT,CAAR;AACA,QAAIE,CAAC,GAAG7B,IAAI,CAAClC,GAAL,CAAS6D,KAAT,CAAR;AACA,QAAIG,GAAG,GAAG1B,WAAW,CAACN,CAAD,EAAI,CAAJ,CAArB;AACA,QAAIiC,GAAG,GAAG3B,WAAW,CAACN,CAAD,EAAI,CAAJ,CAArB;;AAEA,SAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,CAApB,EAAuBkC,CAAC,EAAxB,EAA4B;AAC1BF,MAAAA,GAAG,CAACE,CAAD,CAAH,GAASJ,CAAC,GAAGzB,GAAG,CAAC6B,CAAD,CAAH,CAAO9C,CAAP,CAAJ,GAAgB2C,CAAC,GAAG1B,GAAG,CAAC6B,CAAD,CAAH,CAAO7C,CAAP,CAA7B;AACA4C,MAAAA,GAAG,CAACC,CAAD,CAAH,GAASH,CAAC,GAAG1B,GAAG,CAAC6B,CAAD,CAAH,CAAO9C,CAAP,CAAJ,GAAgB0C,CAAC,GAAGzB,GAAG,CAAC6B,CAAD,CAAH,CAAO7C,CAAP,CAA7B;AACD;;AAED,SAAK,IAAI8C,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGnC,CAAtB,EAAyBmC,EAAE,EAA3B,EAA+B;AAC7B9B,MAAAA,GAAG,CAAC8B,EAAD,CAAH,CAAQ/C,CAAR,IAAa4C,GAAG,CAACG,EAAD,CAAhB;AACA9B,MAAAA,GAAG,CAAC8B,EAAD,CAAH,CAAQ9C,CAAR,IAAa4C,GAAG,CAACE,EAAD,CAAhB;AACD;;AAED,WAAO9B,GAAP;AACD,GA9OgF,CA8O/E;;;AAGF,WAASe,OAAT,CAAiBf,GAAjB,EAAsBwB,KAAtB,EAA6BzC,CAA7B,EAAgCC,CAAhC,EAAmC;AACjC,QAAIW,CAAC,GAAGK,GAAG,CAAC1B,MAAZ;AACA,QAAImD,CAAC,GAAG/D,GAAG,CAAC8D,KAAD,CAAX;AACA,QAAIE,CAAC,GAAG/D,GAAG,CAAC6D,KAAD,CAAX;AACA,QAAIG,GAAG,GAAG1B,WAAW,CAACN,CAAD,EAAI7B,SAAS,CAAC,CAAD,CAAb,CAArB;AACA,QAAI8D,GAAG,GAAG3B,WAAW,CAACN,CAAD,EAAI7B,SAAS,CAAC,CAAD,CAAb,CAArB;;AAEA,SAAK,IAAI+D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,CAApB,EAAuBkC,CAAC,EAAxB,EAA4B;AAC1BF,MAAAA,GAAG,CAACE,CAAD,CAAH,GAASvE,QAAQ,CAACM,cAAc,CAAC6D,CAAD,EAAIzB,GAAG,CAAC6B,CAAD,CAAH,CAAO9C,CAAP,CAAJ,CAAf,EAA+BnB,cAAc,CAAC8D,CAAD,EAAI1B,GAAG,CAAC6B,CAAD,CAAH,CAAO7C,CAAP,CAAJ,CAA7C,CAAjB;AACA4C,MAAAA,GAAG,CAACC,CAAD,CAAH,GAASxE,SAAS,CAACO,cAAc,CAAC8D,CAAD,EAAI1B,GAAG,CAAC6B,CAAD,CAAH,CAAO9C,CAAP,CAAJ,CAAf,EAA+BnB,cAAc,CAAC6D,CAAD,EAAIzB,GAAG,CAAC6B,CAAD,CAAH,CAAO7C,CAAP,CAAJ,CAA7C,CAAlB;AACD;;AAED,SAAK,IAAI+C,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGpC,CAAxB,EAA2BoC,GAAG,EAA9B,EAAkC;AAChC/B,MAAAA,GAAG,CAAC+B,GAAD,CAAH,CAAShD,CAAT,IAAc4C,GAAG,CAACI,GAAD,CAAjB;AACA/B,MAAAA,GAAG,CAAC+B,GAAD,CAAH,CAAS/C,CAAT,IAAc4C,GAAG,CAACG,GAAD,CAAjB;AACD;;AAED,WAAO/B,GAAP;AACD,GAnQgF,CAmQ/E;;;AAGF,WAASc,KAAT,CAAekB,GAAf,EAAoBR,KAApB,EAA2BzC,CAA3B,EAA8BC,CAA9B,EAAiC;AAC/B,QAAIW,CAAC,GAAGqC,GAAG,CAAC1D,MAAZ;AACA,QAAImD,CAAC,GAAG3D,SAAS,CAACJ,GAAG,CAAC8D,KAAD,CAAJ,CAAjB;AACA,QAAIE,CAAC,GAAG5D,SAAS,CAACH,GAAG,CAAC6D,KAAD,CAAJ,CAAjB;AACA,QAAIS,EAAE,GAAGrE,cAAc,CAAC6D,CAAD,EAAIA,CAAJ,CAAvB;AACA,QAAIS,EAAE,GAAGtE,cAAc,CAAC8D,CAAD,EAAIA,CAAJ,CAAvB;AACA,QAAIS,GAAG,GAAGlC,WAAW,CAACN,CAAD,EAAI7B,SAAS,CAAC,CAAD,CAAb,CAArB;AACA,QAAIsE,GAAG,GAAGnC,WAAW,CAACN,CAAD,EAAI7B,SAAS,CAAC,CAAD,CAAb,CAArB,CAP+B,CAOS;;AAExC,QAAIuE,KAAK,GAAGtE,QAAQ,CAACD,SAAS,CAAC,CAAD,CAAV,EAAe2D,CAAf,EAAkBC,CAAlB,EAAqBM,GAAG,CAACjD,CAAD,CAAH,CAAOC,CAAP,CAArB,CAApB,CAT+B,CASsB;;AAErD,QAAIsD,GAAG,GAAGjF,SAAS,CAACC,QAAQ,CAACM,cAAc,CAACqE,EAAD,EAAKD,GAAG,CAACjD,CAAD,CAAH,CAAOA,CAAP,CAAL,CAAf,EAAgCsD,KAAhC,CAAT,EAAiDzE,cAAc,CAACsE,EAAD,EAAKF,GAAG,CAAChD,CAAD,CAAH,CAAOA,CAAP,CAAL,CAA/D,CAAnB;AACA,QAAIuD,GAAG,GAAGvE,GAAG,CAACJ,cAAc,CAACsE,EAAD,EAAKF,GAAG,CAACjD,CAAD,CAAH,CAAOA,CAAP,CAAL,CAAf,EAAgCsD,KAAhC,EAAuCzE,cAAc,CAACqE,EAAD,EAAKD,GAAG,CAAChD,CAAD,CAAH,CAAOA,CAAP,CAAL,CAArD,CAAb,CAZ+B,CAYqD;;AAEpF,SAAK,IAAI6C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,CAApB,EAAuBkC,CAAC,EAAxB,EAA4B;AAC1BM,MAAAA,GAAG,CAACN,CAAD,CAAH,GAASvE,QAAQ,CAACM,cAAc,CAAC6D,CAAD,EAAIO,GAAG,CAACjD,CAAD,CAAH,CAAO8C,CAAP,CAAJ,CAAf,EAA+BjE,cAAc,CAAC8D,CAAD,EAAIM,GAAG,CAAChD,CAAD,CAAH,CAAO6C,CAAP,CAAJ,CAA7C,CAAjB;AACAO,MAAAA,GAAG,CAACP,CAAD,CAAH,GAASxE,SAAS,CAACO,cAAc,CAAC8D,CAAD,EAAIM,GAAG,CAACjD,CAAD,CAAH,CAAO8C,CAAP,CAAJ,CAAf,EAA+BjE,cAAc,CAAC6D,CAAD,EAAIO,GAAG,CAAChD,CAAD,CAAH,CAAO6C,CAAP,CAAJ,CAA7C,CAAlB;AACD,KAjB8B,CAiB7B;;;AAGFG,IAAAA,GAAG,CAACjD,CAAD,CAAH,CAAOA,CAAP,IAAYuD,GAAZ;AACAN,IAAAA,GAAG,CAAChD,CAAD,CAAH,CAAOA,CAAP,IAAYuD,GAAZ;AACAP,IAAAA,GAAG,CAACjD,CAAD,CAAH,CAAOC,CAAP,IAAYlB,SAAS,CAAC,CAAD,CAArB;AACAkE,IAAAA,GAAG,CAAChD,CAAD,CAAH,CAAOD,CAAP,IAAYjB,SAAS,CAAC,CAAD,CAArB,CAvB+B,CAuBL;;AAE1B,SAAK,IAAI0E,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAG7C,CAAxB,EAA2B6C,GAAG,EAA9B,EAAkC;AAChC,UAAIA,GAAG,KAAKzD,CAAR,IAAayD,GAAG,KAAKxD,CAAzB,EAA4B;AAC1BgD,QAAAA,GAAG,CAACjD,CAAD,CAAH,CAAOyD,GAAP,IAAcL,GAAG,CAACK,GAAD,CAAjB;AACAR,QAAAA,GAAG,CAACQ,GAAD,CAAH,CAASzD,CAAT,IAAcoD,GAAG,CAACK,GAAD,CAAjB;AACAR,QAAAA,GAAG,CAAChD,CAAD,CAAH,CAAOwD,GAAP,IAAcJ,GAAG,CAACI,GAAD,CAAjB;AACAR,QAAAA,GAAG,CAACQ,GAAD,CAAH,CAASxD,CAAT,IAAcoD,GAAG,CAACI,GAAD,CAAjB;AACD;AACF;;AAED,WAAOR,GAAP;AACD,GAzSgF,CAyS/E;;;AAGF,WAAS1B,EAAT,CAAY0B,GAAZ,EAAiBR,KAAjB,EAAwBzC,CAAxB,EAA2BC,CAA3B,EAA8B;AAC5B,QAAIW,CAAC,GAAGqC,GAAG,CAAC1D,MAAZ;AACA,QAAImD,CAAC,GAAG5B,IAAI,CAACnC,GAAL,CAAS8D,KAAT,CAAR;AACA,QAAIE,CAAC,GAAG7B,IAAI,CAAClC,GAAL,CAAS6D,KAAT,CAAR;AACA,QAAIS,EAAE,GAAGR,CAAC,GAAGA,CAAb;AACA,QAAIS,EAAE,GAAGR,CAAC,GAAGA,CAAb;AACA,QAAIS,GAAG,GAAGlC,WAAW,CAACN,CAAD,EAAI,CAAJ,CAArB;AACA,QAAIyC,GAAG,GAAGnC,WAAW,CAACN,CAAD,EAAI,CAAJ,CAArB,CAP4B,CAOC;;AAE7B,QAAI2C,GAAG,GAAGL,EAAE,GAAGD,GAAG,CAACjD,CAAD,CAAH,CAAOA,CAAP,CAAL,GAAiB,IAAI0C,CAAJ,GAAQC,CAAR,GAAYM,GAAG,CAACjD,CAAD,CAAH,CAAOC,CAAP,CAA7B,GAAyCkD,EAAE,GAAGF,GAAG,CAAChD,CAAD,CAAH,CAAOA,CAAP,CAAxD;AACA,QAAIuD,GAAG,GAAGL,EAAE,GAAGF,GAAG,CAACjD,CAAD,CAAH,CAAOA,CAAP,CAAL,GAAiB,IAAI0C,CAAJ,GAAQC,CAAR,GAAYM,GAAG,CAACjD,CAAD,CAAH,CAAOC,CAAP,CAA7B,GAAyCiD,EAAE,GAAGD,GAAG,CAAChD,CAAD,CAAH,CAAOA,CAAP,CAAxD,CAV4B,CAUuC;;AAEnE,SAAK,IAAI6C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,CAApB,EAAuBkC,CAAC,EAAxB,EAA4B;AAC1BM,MAAAA,GAAG,CAACN,CAAD,CAAH,GAASJ,CAAC,GAAGO,GAAG,CAACjD,CAAD,CAAH,CAAO8C,CAAP,CAAJ,GAAgBH,CAAC,GAAGM,GAAG,CAAChD,CAAD,CAAH,CAAO6C,CAAP,CAA7B;AACAO,MAAAA,GAAG,CAACP,CAAD,CAAH,GAASH,CAAC,GAAGM,GAAG,CAACjD,CAAD,CAAH,CAAO8C,CAAP,CAAJ,GAAgBJ,CAAC,GAAGO,GAAG,CAAChD,CAAD,CAAH,CAAO6C,CAAP,CAA7B;AACD,KAf2B,CAe1B;;;AAGFG,IAAAA,GAAG,CAACjD,CAAD,CAAH,CAAOA,CAAP,IAAYuD,GAAZ;AACAN,IAAAA,GAAG,CAAChD,CAAD,CAAH,CAAOA,CAAP,IAAYuD,GAAZ;AACAP,IAAAA,GAAG,CAACjD,CAAD,CAAH,CAAOC,CAAP,IAAY,CAAZ;AACAgD,IAAAA,GAAG,CAAChD,CAAD,CAAH,CAAOD,CAAP,IAAY,CAAZ,CArB4B,CAqBb;;AAEf,SAAK,IAAI0D,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAG9C,CAAxB,EAA2B8C,GAAG,EAA9B,EAAkC;AAChC,UAAIA,GAAG,KAAK1D,CAAR,IAAa0D,GAAG,KAAKzD,CAAzB,EAA4B;AAC1BgD,QAAAA,GAAG,CAACjD,CAAD,CAAH,CAAO0D,GAAP,IAAcN,GAAG,CAACM,GAAD,CAAjB;AACAT,QAAAA,GAAG,CAACS,GAAD,CAAH,CAAS1D,CAAT,IAAcoD,GAAG,CAACM,GAAD,CAAjB;AACAT,QAAAA,GAAG,CAAChD,CAAD,CAAH,CAAOyD,GAAP,IAAcL,GAAG,CAACK,GAAD,CAAjB;AACAT,QAAAA,GAAG,CAACS,GAAD,CAAH,CAASzD,CAAT,IAAcoD,GAAG,CAACK,GAAD,CAAjB;AACD;AACF;;AAED,WAAOT,GAAP;AACD,GA7UgF,CA6U/E;;;AAGF,WAAS7B,MAAT,CAAgBuC,GAAhB,EAAqB;AACnB,QAAI/C,CAAC,GAAG+C,GAAG,CAACpE,MAAZ;AACA,QAAIqE,MAAM,GAAG,CAAb;AACA,QAAIC,KAAK,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAZ;;AAEA,SAAK,IAAI7D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGY,CAApB,EAAuBZ,CAAC,EAAxB,EAA4B;AAC1B,WAAK,IAAIC,CAAC,GAAGD,CAAC,GAAG,CAAjB,EAAoBC,CAAC,GAAGW,CAAxB,EAA2BX,CAAC,EAA5B,EAAgC;AAC9B,YAAIa,IAAI,CAACrC,GAAL,CAASmF,MAAT,IAAmB9C,IAAI,CAACrC,GAAL,CAASkF,GAAG,CAAC3D,CAAD,CAAH,CAAOC,CAAP,CAAT,CAAvB,EAA4C;AAC1C2D,UAAAA,MAAM,GAAG9C,IAAI,CAACrC,GAAL,CAASkF,GAAG,CAAC3D,CAAD,CAAH,CAAOC,CAAP,CAAT,CAAT;AACA4D,UAAAA,KAAK,GAAG,CAAC7D,CAAD,EAAIC,CAAJ,CAAR;AACD;AACF;AACF;;AAED,WAAO,CAAC4D,KAAD,EAAQD,MAAR,CAAP;AACD,GA/VgF,CA+V/E;;;AAGF,WAAShC,SAAT,CAAmB+B,GAAnB,EAAwB;AACtB,QAAI/C,CAAC,GAAG+C,GAAG,CAACpE,MAAZ;AACA,QAAIqE,MAAM,GAAG,CAAb;AACA,QAAIC,KAAK,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAZ;;AAEA,SAAK,IAAI7D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGY,CAApB,EAAuBZ,CAAC,EAAxB,EAA4B;AAC1B,WAAK,IAAIC,CAAC,GAAGD,CAAC,GAAG,CAAjB,EAAoBC,CAAC,GAAGW,CAAxB,EAA2BX,CAAC,EAA5B,EAAgC;AAC9B,YAAIxB,GAAG,CAACmF,MAAD,CAAH,GAAcnF,GAAG,CAACkF,GAAG,CAAC3D,CAAD,CAAH,CAAOC,CAAP,CAAD,CAArB,EAAkC;AAChC2D,UAAAA,MAAM,GAAGnF,GAAG,CAACkF,GAAG,CAAC3D,CAAD,CAAH,CAAOC,CAAP,CAAD,CAAZ;AACA4D,UAAAA,KAAK,GAAG,CAAC7D,CAAD,EAAIC,CAAJ,CAAR;AACD;AACF;AACF;;AAED,WAAO,CAAC4D,KAAD,EAAQD,MAAR,CAAP;AACD,GAjXgF,CAiX/E;;;AAGF,WAASjC,OAAT,CAAiBmC,CAAjB,EAAoBC,CAApB,EAAuB;AACrB,QAAInD,CAAC,GAAGkD,CAAC,CAACvE,MAAV;AACA,QAAIyE,EAAE,GAAG7E,KAAK,CAACyB,CAAD,CAAd;AACA,QAAIqD,EAAE,GAAG9E,KAAK,CAACyB,CAAD,CAAd;;AAEA,SAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,CAApB,EAAuBkC,CAAC,EAAxB,EAA4B;AAC1BmB,MAAAA,EAAE,CAACnB,CAAD,CAAF,GAAQ3D,KAAK,CAACyB,CAAD,CAAb;AACD;;AAED,SAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGY,CAApB,EAAuBZ,CAAC,EAAxB,EAA4B;AAC1B,UAAIkE,KAAK,GAAG,CAAZ;AACA,UAAIC,IAAI,GAAGL,CAAC,CAAC,CAAD,CAAZ;;AAEA,WAAK,IAAI7D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6D,CAAC,CAACvE,MAAtB,EAA8BU,CAAC,EAA/B,EAAmC;AACjC,YAAI6D,CAAC,CAAC7D,CAAD,CAAD,GAAOkE,IAAX,EAAiB;AACfD,UAAAA,KAAK,GAAGjE,CAAR;AACAkE,UAAAA,IAAI,GAAGL,CAAC,CAACI,KAAD,CAAR;AACD;AACF;;AAEDF,MAAAA,EAAE,CAAChE,CAAD,CAAF,GAAQ8D,CAAC,CAACM,MAAF,CAASF,KAAT,EAAgB,CAAhB,EAAmB,CAAnB,CAAR;;AAEA,WAAK,IAAIG,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGzD,CAAxB,EAA2ByD,GAAG,EAA9B,EAAkC;AAChCJ,QAAAA,EAAE,CAACI,GAAD,CAAF,CAAQrE,CAAR,IAAa+D,CAAC,CAACM,GAAD,CAAD,CAAOH,KAAP,CAAb;;AAEAH,QAAAA,CAAC,CAACM,GAAD,CAAD,CAAOD,MAAP,CAAcF,KAAd,EAAqB,CAArB;AACD;AACF;;AAED,WAAO,CAACtG,KAAK,CAACoG,EAAD,CAAN,EAAYpG,KAAK,CAACqG,EAAD,CAAjB,CAAP;AACD;AACD;;;;;;;;AAQA,WAAS/C,WAAT,CAAqB5B,IAArB,EAA2BgF,KAA3B,EAAkC;AAChC;AACA,QAAIC,KAAK,GAAG,IAAIpF,KAAJ,CAAUG,IAAV,CAAZ;;AAEA,SAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,IAApB,EAA0BU,CAAC,EAA3B,EAA+B;AAC7BuE,MAAAA,KAAK,CAACvE,CAAD,CAAL,GAAWsE,KAAX;AACD;;AAED,WAAOC,KAAP;AACD;;AAED,SAAOrF,IAAP;AACD,CAva6C,CAAvC","sourcesContent":["import { clone } from '../../utils/object';\nimport { factory } from '../../utils/factory';\nimport { format } from '../../utils/string';\nvar name = 'eigs';\nvar dependencies = ['config', 'typed', 'matrix', 'addScalar', 'equal', 'subtract', 'abs', 'atan', 'cos', 'sin', 'multiplyScalar', 'inv', 'bignumber', 'multiply', 'add'];\nexport var createEigs = /* #__PURE__ */factory(name, dependencies, function (_ref) {\n  var config = _ref.config,\n      typed = _ref.typed,\n      matrix = _ref.matrix,\n      addScalar = _ref.addScalar,\n      subtract = _ref.subtract,\n      equal = _ref.equal,\n      abs = _ref.abs,\n      atan = _ref.atan,\n      cos = _ref.cos,\n      sin = _ref.sin,\n      multiplyScalar = _ref.multiplyScalar,\n      inv = _ref.inv,\n      bignumber = _ref.bignumber,\n      multiply = _ref.multiply,\n      add = _ref.add;\n\n  /**\n   * Compute eigenvalue and eigenvector of a real symmetric matrix.\n   * Only applicable to two dimensional symmetric matrices. Uses Jacobi\n   * Algorithm. Matrix containing mixed type ('number', 'bignumber', 'fraction')\n   * of elements are not supported. Input matrix or 2D array should contain all elements\n   * of either 'number', 'bignumber' or 'fraction' type. For 'number' and 'fraction', the\n   * eigenvalues are of 'number' type. For 'bignumber' the eigenvalues are of ''bignumber' type.\n   * Eigenvectors are always of 'number' type.\n   *\n   * Syntax:\n   *\n   *     math.eigs(x)\n   *\n   * Examples:\n   *\n   *     const H = [[5, 2.3], [2.3, 1]]\n   *     const ans = math.eigs(H) // returns {values: [E1,E2...sorted], vectors: [v1,v2.... corresponding vectors]}\n   *     const E = ans.values\n   *     const U = ans.vectors\n   *     const UTxHxU = math.multiply(math.transpose(U), H, U) // rotates H to the eigen-representation\n   *     E[0] == UTxHxU[0][0]  // returns true\n   * See also:\n   *\n   *     inv\n   *\n   * @param {Array | Matrix} x  Matrix to be diagonalized\n   * @return {{values: Array, vectors: Array} | {values: Matrix, vectors: Matrix}} Object containing eigenvalues (Array or Matrix) and eigenvectors (2D Array/Matrix).\n   */\n  var eigs = typed('eigs', {\n    Array: function Array(x) {\n      // check array size\n      var mat = matrix(x);\n      var size = mat.size();\n\n      if (size.length !== 2 || size[0] !== size[1]) {\n        throw new RangeError('Matrix must be square ' + '(size: ' + format(size) + ')');\n      } // use dense 2D matrix implementation\n\n\n      var ans = checkAndSubmit(mat, size[0]);\n      return {\n        values: ans[0],\n        vectors: ans[1]\n      };\n    },\n    Matrix: function Matrix(x) {\n      // use dense 2D array implementation\n      // dense matrix\n      var size = x.size();\n\n      if (size.length !== 2 || size[0] !== size[1]) {\n        throw new RangeError('Matrix must be square ' + '(size: ' + format(size) + ')');\n      }\n\n      var ans = checkAndSubmit(x, size[0]);\n      return {\n        values: matrix(ans[0]),\n        vectors: matrix(ans[1])\n      };\n    }\n  }); // Is the matrix\n  // symmetric ?\n\n  function isSymmetric(x, n) {\n    for (var i = 0; i < n; i++) {\n      for (var j = i; j < n; j++) {\n        // not symmtric\n        if (!equal(x[i][j], x[j][i])) {\n          throw new TypeError('Input matrix is not symmetric');\n        }\n      }\n    }\n  } // check input for possible problems\n  // and perform diagonalization efficiently for\n  // specific type of number\n\n\n  function checkAndSubmit(x, n) {\n    var type = x.datatype(); // type check\n\n    if (type === undefined) {\n      type = x.getDataType();\n    }\n\n    if (type !== 'number' && type !== 'BigNumber' && type !== 'Fraction') {\n      if (type === 'mixed') {\n        throw new TypeError('Mixed matrix element type is not supported');\n      } else {\n        throw new TypeError('Matrix element type not supported (' + type + ')');\n      }\n    } else {\n      isSymmetric(x.toArray(), n);\n    } // perform efficient calculation for 'numbers'\n\n\n    if (type === 'number') {\n      return diag(x.toArray());\n    } else if (type === 'Fraction') {\n      var xArr = x.toArray(); // convert fraction to numbers\n\n      for (var i = 0; i < n; i++) {\n        for (var j = i; j < n; j++) {\n          xArr[i][j] = xArr[i][j].valueOf();\n          xArr[j][i] = xArr[i][j];\n        }\n      }\n\n      return diag(x.toArray());\n    } else if (type === 'BigNumber') {\n      return diagBig(x.toArray());\n    }\n  } // diagonalization implementation for number (efficient)\n\n\n  function diag(x) {\n    var N = x.length;\n    var e0 = Math.abs(config.epsilon / N);\n    var psi;\n    var Sij = new Array(N); // Sij is Identity Matrix\n\n    for (var i = 0; i < N; i++) {\n      Sij[i] = createArray(N, 0);\n      Sij[i][i] = 1.0;\n    } // initial error\n\n\n    var Vab = getAij(x);\n\n    while (Math.abs(Vab[1]) >= Math.abs(e0)) {\n      var _i = Vab[0][0];\n      var j = Vab[0][1];\n      psi = getTheta(x[_i][_i], x[j][j], x[_i][j]);\n      x = x1(x, psi, _i, j);\n      Sij = Sij1(Sij, psi, _i, j);\n      Vab = getAij(x);\n    }\n\n    var Ei = createArray(N, 0); // eigenvalues\n\n    for (var _i2 = 0; _i2 < N; _i2++) {\n      Ei[_i2] = x[_i2][_i2];\n    }\n\n    return sorting(clone(Ei), clone(Sij));\n  } // diagonalization implementation for bigNumber\n\n\n  function diagBig(x) {\n    var N = x.length;\n    var e0 = abs(config.epsilon / N);\n    var psi;\n    var Sij = new Array(N); // Sij is Identity Matrix\n\n    for (var i = 0; i < N; i++) {\n      Sij[i] = createArray(N, 0);\n      Sij[i][i] = 1.0;\n    } // initial error\n\n\n    var Vab = getAijBig(x);\n\n    while (abs(Vab[1]) >= abs(e0)) {\n      var _i3 = Vab[0][0];\n      var j = Vab[0][1];\n      psi = getThetaBig(x[_i3][_i3], x[j][j], x[_i3][j]);\n      x = x1Big(x, psi, _i3, j);\n      Sij = Sij1Big(Sij, psi, _i3, j);\n      Vab = getAijBig(x);\n    }\n\n    var Ei = createArray(N, 0); // eigenvalues\n\n    for (var _i4 = 0; _i4 < N; _i4++) {\n      Ei[_i4] = x[_i4][_i4];\n    } // return [clone(Ei), clone(Sij)]\n\n\n    return sorting(clone(Ei), clone(Sij));\n  } // get angle\n\n\n  function getTheta(aii, ajj, aij) {\n    var denom = ajj - aii;\n\n    if (Math.abs(denom) <= config.epsilon) {\n      return Math.PI / 4;\n    } else {\n      return 0.5 * Math.atan(2 * aij / (ajj - aii));\n    }\n  } // get angle\n\n\n  function getThetaBig(aii, ajj, aij) {\n    var denom = subtract(ajj, aii);\n\n    if (abs(denom) <= config.epsilon) {\n      return bignumber(-1).acos().div(4);\n    } else {\n      return multiplyScalar(0.5, atan(multiply(2, aij, inv(denom))));\n    }\n  } // update eigvec\n\n\n  function Sij1(Sij, theta, i, j) {\n    var N = Sij.length;\n    var c = Math.cos(theta);\n    var s = Math.sin(theta);\n    var Ski = createArray(N, 0);\n    var Skj = createArray(N, 0);\n\n    for (var k = 0; k < N; k++) {\n      Ski[k] = c * Sij[k][i] - s * Sij[k][j];\n      Skj[k] = s * Sij[k][i] + c * Sij[k][j];\n    }\n\n    for (var _k = 0; _k < N; _k++) {\n      Sij[_k][i] = Ski[_k];\n      Sij[_k][j] = Skj[_k];\n    }\n\n    return Sij;\n  } // update eigvec for overlap\n\n\n  function Sij1Big(Sij, theta, i, j) {\n    var N = Sij.length;\n    var c = cos(theta);\n    var s = sin(theta);\n    var Ski = createArray(N, bignumber(0));\n    var Skj = createArray(N, bignumber(0));\n\n    for (var k = 0; k < N; k++) {\n      Ski[k] = subtract(multiplyScalar(c, Sij[k][i]), multiplyScalar(s, Sij[k][j]));\n      Skj[k] = addScalar(multiplyScalar(s, Sij[k][i]), multiplyScalar(c, Sij[k][j]));\n    }\n\n    for (var _k2 = 0; _k2 < N; _k2++) {\n      Sij[_k2][i] = Ski[_k2];\n      Sij[_k2][j] = Skj[_k2];\n    }\n\n    return Sij;\n  } // update matrix\n\n\n  function x1Big(Hij, theta, i, j) {\n    var N = Hij.length;\n    var c = bignumber(cos(theta));\n    var s = bignumber(sin(theta));\n    var c2 = multiplyScalar(c, c);\n    var s2 = multiplyScalar(s, s);\n    var Aki = createArray(N, bignumber(0));\n    var Akj = createArray(N, bignumber(0)); // 2cs Hij\n\n    var csHij = multiply(bignumber(2), c, s, Hij[i][j]); //  Aii\n\n    var Aii = addScalar(subtract(multiplyScalar(c2, Hij[i][i]), csHij), multiplyScalar(s2, Hij[j][j]));\n    var Ajj = add(multiplyScalar(s2, Hij[i][i]), csHij, multiplyScalar(c2, Hij[j][j])); // 0  to i\n\n    for (var k = 0; k < N; k++) {\n      Aki[k] = subtract(multiplyScalar(c, Hij[i][k]), multiplyScalar(s, Hij[j][k]));\n      Akj[k] = addScalar(multiplyScalar(s, Hij[i][k]), multiplyScalar(c, Hij[j][k]));\n    } // Modify Hij\n\n\n    Hij[i][i] = Aii;\n    Hij[j][j] = Ajj;\n    Hij[i][j] = bignumber(0);\n    Hij[j][i] = bignumber(0); // 0  to i\n\n    for (var _k3 = 0; _k3 < N; _k3++) {\n      if (_k3 !== i && _k3 !== j) {\n        Hij[i][_k3] = Aki[_k3];\n        Hij[_k3][i] = Aki[_k3];\n        Hij[j][_k3] = Akj[_k3];\n        Hij[_k3][j] = Akj[_k3];\n      }\n    }\n\n    return Hij;\n  } // update matrix\n\n\n  function x1(Hij, theta, i, j) {\n    var N = Hij.length;\n    var c = Math.cos(theta);\n    var s = Math.sin(theta);\n    var c2 = c * c;\n    var s2 = s * s;\n    var Aki = createArray(N, 0);\n    var Akj = createArray(N, 0); //  Aii\n\n    var Aii = c2 * Hij[i][i] - 2 * c * s * Hij[i][j] + s2 * Hij[j][j];\n    var Ajj = s2 * Hij[i][i] + 2 * c * s * Hij[i][j] + c2 * Hij[j][j]; // 0  to i\n\n    for (var k = 0; k < N; k++) {\n      Aki[k] = c * Hij[i][k] - s * Hij[j][k];\n      Akj[k] = s * Hij[i][k] + c * Hij[j][k];\n    } // Modify Hij\n\n\n    Hij[i][i] = Aii;\n    Hij[j][j] = Ajj;\n    Hij[i][j] = 0;\n    Hij[j][i] = 0; // 0  to i\n\n    for (var _k4 = 0; _k4 < N; _k4++) {\n      if (_k4 !== i && _k4 !== j) {\n        Hij[i][_k4] = Aki[_k4];\n        Hij[_k4][i] = Aki[_k4];\n        Hij[j][_k4] = Akj[_k4];\n        Hij[_k4][j] = Akj[_k4];\n      }\n    }\n\n    return Hij;\n  } // get max off-diagonal value from Upper Diagonal\n\n\n  function getAij(Mij) {\n    var N = Mij.length;\n    var maxMij = 0;\n    var maxIJ = [0, 1];\n\n    for (var i = 0; i < N; i++) {\n      for (var j = i + 1; j < N; j++) {\n        if (Math.abs(maxMij) < Math.abs(Mij[i][j])) {\n          maxMij = Math.abs(Mij[i][j]);\n          maxIJ = [i, j];\n        }\n      }\n    }\n\n    return [maxIJ, maxMij];\n  } // get max off-diagonal value from Upper Diagonal\n\n\n  function getAijBig(Mij) {\n    var N = Mij.length;\n    var maxMij = 0;\n    var maxIJ = [0, 1];\n\n    for (var i = 0; i < N; i++) {\n      for (var j = i + 1; j < N; j++) {\n        if (abs(maxMij) < abs(Mij[i][j])) {\n          maxMij = abs(Mij[i][j]);\n          maxIJ = [i, j];\n        }\n      }\n    }\n\n    return [maxIJ, maxMij];\n  } // sort results\n\n\n  function sorting(E, S) {\n    var N = E.length;\n    var Ef = Array(N);\n    var Sf = Array(N);\n\n    for (var k = 0; k < N; k++) {\n      Sf[k] = Array(N);\n    }\n\n    for (var i = 0; i < N; i++) {\n      var minID = 0;\n      var minE = E[0];\n\n      for (var j = 0; j < E.length; j++) {\n        if (E[j] < minE) {\n          minID = j;\n          minE = E[minID];\n        }\n      }\n\n      Ef[i] = E.splice(minID, 1)[0];\n\n      for (var _k5 = 0; _k5 < N; _k5++) {\n        Sf[_k5][i] = S[_k5][minID];\n\n        S[_k5].splice(minID, 1);\n      }\n    }\n\n    return [clone(Ef), clone(Sf)];\n  }\n  /**\n   * Create an array of a certain size and fill all items with an initial value\n   * @param {number} size\n   * @param {number} value\n   * @return {number[]}\n   */\n\n\n  function createArray(size, value) {\n    // TODO: as soon as all browsers support Array.fill, use that instead (IE doesn't support it)\n    var array = new Array(size);\n\n    for (var i = 0; i < size; i++) {\n      array[i] = value;\n    }\n\n    return array;\n  }\n\n  return eigs;\n});"]},"metadata":{},"sourceType":"module"}