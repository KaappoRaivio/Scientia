{"ast":null,"code":"var _jsxFileName = \"/home/kaappo/testit/canvas/src/components/compass.js\";\nimport React from 'react';\nimport { mod } from \"mathjs\";\nimport \"/home/kaappo/testit/canvas/src/components/compass.css\";\nimport NumberDisplay from \"/home/kaappo/testit/canvas/src/components/numberdisplay.js\";\n\nclass Compass extends React.Component {\n  constructor(props) {\n    super(props);\n    this.props = {\n      width: props.width,\n      height: props.height,\n      heading: props.heading\n    };\n    this.arcCenterOffsetY = 110;\n    this.radius = this.getCircleRadius();\n    this.numberDisplay = React.createRef();\n  }\n\n  getCircleRadius() {\n    return Math.sqrt((this.props.width / 2) ** 2 + this.arcCenterOffsetY ** 2);\n  }\n\n  componentDidMount() {\n    this.canvas = this.refs.canvas;\n    const ctx = this.canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); // img.onload = () => {\n    // ctx.drawImage(img, 0, 0);\n\n    ctx.font = \"40px Courier\";\n    ctx.textAlign = \"center\";\n    ctx.fillText(this.props.heading.toFixed(2), this.props.width / 2, this.canvas.height);\n    ctx.beginPath();\n    ctx.arc(this.props.width / 2, this.canvas.height + this.arcCenterOffsetY, this.radius, 0, 2 * Math.PI);\n    ctx.fillRect(this.props.width / 2 - 1, this.canvas.height - this.radius + this.arcCenterOffsetY - 10, 2, 10);\n    let divisions = [12, 36, 72];\n    ctx.font = \"20px Courier\";\n\n    for (let index = 0; index < divisions.length; index++) {\n      let division = divisions[index];\n\n      for (let i = 0; i < division; i++) {\n        let baseAngle = 2 * Math.PI / division * i;\n        let angleOffset = this.props.heading * Math.PI / 180; // ctx.fillText(this.props.heading.toFixed(2), start[0] + 5, start[1] + 5)\n\n        this.drawCompassLine(ctx, baseAngle + angleOffset, ((divisions.length - index + 1) / divisions.length) ** 2 * 15);\n\n        if (index === 0) {\n          let angleText = mod(180 - baseAngle / Math.PI * 180, 360);\n          this.drawAngleText(ctx, baseAngle + angleOffset, angleText.toFixed(0));\n        }\n      }\n    }\n\n    ctx.closePath();\n    ctx.stroke(); // }\n  }\n\n  getPosFromAngle(angle, offset) {\n    return [this.canvas.width / 2 + Math.sin(angle) * this.radius - offset * Math.sin(angle), this.canvas.height + this.arcCenterOffsetY + Math.cos(angle) * this.radius - offset * Math.cos(angle)];\n  }\n\n  drawAngleText(ctx, angle, text) {\n    let pos = this.getPosFromAngle(angle, 0);\n    let x = pos[0];\n    let y = pos[1];\n    ctx.save();\n    ctx.translate(x + 40 * Math.sin(angle - Math.PI), y + 40 * Math.cos(angle - Math.PI));\n    ctx.rotate(-angle + Math.PI);\n    ctx.textAlign = 'center';\n    ctx.fillText(text, 0, 10);\n    ctx.restore();\n  }\n\n  drawCompassLine(ctx, angle, length) {\n    let end = this.getPosFromAngle(angle, 0);\n    let start = this.getPosFromAngle(angle, length);\n    ctx.moveTo(start[0], start[1]);\n    ctx.lineTo(end[0], end[1]);\n  }\n\n  componentDidUpdate() {\n    this.componentDidMount();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 16\n      }\n    }, /*#__PURE__*/React.createElement(NumberDisplay, {\n      value: this.props.heading,\n      suffix: \"\\xB0\",\n      unit: \"T\",\n      width: this.props.width,\n      height: 100,\n      upperLimit: 360,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: \"canvas\",\n      className: \"compassRose\",\n      width: this.props.width,\n      height: this.props.height / 3,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 13\n      }\n    }));\n  }\n\n}\n\nexport default Compass;","map":{"version":3,"sources":["/home/kaappo/testit/canvas/src/components/compass.js"],"names":["React","mod","NumberDisplay","Compass","Component","constructor","props","width","height","heading","arcCenterOffsetY","radius","getCircleRadius","numberDisplay","createRef","Math","sqrt","componentDidMount","canvas","refs","ctx","getContext","clearRect","font","textAlign","fillText","toFixed","beginPath","arc","PI","fillRect","divisions","index","length","division","i","baseAngle","angleOffset","drawCompassLine","angleText","drawAngleText","closePath","stroke","getPosFromAngle","angle","offset","sin","cos","text","pos","x","y","save","translate","rotate","restore","end","start","moveTo","lineTo","componentDidUpdate","render"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { mod } from \"mathjs\";\nimport \"/home/kaappo/testit/canvas/src/components/compass.css\"\nimport NumberDisplay from \"/home/kaappo/testit/canvas/src/components/numberdisplay.js\"\n\n\nclass Compass extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.props = {\n            width: props.width,\n            height: props.height,\n            heading: props.heading,\n        };\n\n        this.arcCenterOffsetY = 110;\n        this.radius = this.getCircleRadius();\n\n        this.numberDisplay = React.createRef();\n    }\n\n    getCircleRadius () {\n        return Math.sqrt((this.props.width / 2) ** 2 + this.arcCenterOffsetY ** 2)\n    }\n\n    componentDidMount() {\n\n        this.canvas = this.refs.canvas;\n        const ctx = this.canvas.getContext(\"2d\");\n        \n        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        // img.onload = () => {\n            // ctx.drawImage(img, 0, 0);\n        ctx.font = \"40px Courier\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(this.props.heading.toFixed(2), this.props.width / 2, this.canvas.height);\n\n        ctx.beginPath();\n        ctx.arc(this.props.width / 2, this.canvas.height + this.arcCenterOffsetY, this.radius, 0, 2 * Math.PI);\n        ctx.fillRect(this.props.width / 2 - 1, this.canvas.height - this.radius + this.arcCenterOffsetY - 10, 2, 10)\n        \n        let divisions = [12, 36, 72];\n        ctx.font = \"20px Courier\";\n        for (let index = 0; index < divisions.length; index++) {\n            let division = divisions[index]\n            for (let i = 0; i < division; i++) {\n                let baseAngle =  2 * Math.PI / division * i;\n                let angleOffset = this.props.heading * Math.PI / 180;\n                \n                \n                // ctx.fillText(this.props.heading.toFixed(2), start[0] + 5, start[1] + 5)\n                this.drawCompassLine(ctx, baseAngle + angleOffset, ((divisions.length - index + 1) / divisions.length) ** 2 * 15)\n                if (index === 0) {\n                    let angleText = mod(180 - baseAngle / Math.PI * 180, 360)\n                    this.drawAngleText(ctx, baseAngle + angleOffset, angleText.toFixed(0))\n                }\n            }\n        }\n\n        ctx.closePath();\n        ctx.stroke();\n        // }\n    }\n\n\n    getPosFromAngle (angle, offset) {\n        return [this.canvas.width / 2 + Math.sin(angle) * this.radius - offset * Math.sin(angle), this.canvas.height + this.arcCenterOffsetY + Math.cos(angle) * this.radius - offset * Math.cos(angle)]\n    }\n\n    drawAngleText (ctx, angle, text) {\n        let pos = this.getPosFromAngle(angle, 0)\n        let x = pos[0];\n        let y = pos[1];\n\n        ctx.save();\n        ctx.translate(x + 40 * Math.sin(angle - Math.PI), y + 40 * Math.cos(angle - Math.PI));\n        ctx.rotate(-angle + Math.PI);\n\n        ctx.textAlign = 'center';\n        ctx.fillText(text, 0, 10);\n\n        ctx.restore();\n\n    }\n\n    drawCompassLine (ctx, angle, length) {\n        let end = this.getPosFromAngle(angle, 0)\n        let start = this.getPosFromAngle(angle, length)\n\n        ctx.moveTo(start[0], start[1]);\n        ctx.lineTo(end[0], end[1]);\n    }\n\n    componentDidUpdate () {\n        this.componentDidMount();\n    }\n\n    render () {\n        return <div className=\"container\">\n            <NumberDisplay value={this.props.heading} suffix=\"°\" unit=\"T\" width={this.props.width} height={100} upperLimit={360} />            \n            <canvas ref=\"canvas\" className=\"compassRose\" width={this.props.width} height={this.props.height / 3} />\n        </div>\n    }\n}\n\nexport default Compass"]},"metadata":{},"sourceType":"module"}